# Практика 2. Rest Service

## Программирование. Rest Service. Часть I

### Задание А (3 балла)
Создайте простой REST сервис, в котором используются HTTP операции GET, POST, PUT и DELETE.
Предположим, что это сервис для будущего интернет-магазина, который пока что умеет 
работать только со списком продуктов. У каждого продукта есть поля: `id` (уникальный идентификатор),
`name` и `description`. 

Таким образом, json-схема продукта (обозначим её `<product-json>`):

```json
{
  "id": 0,
  "name": "string",
  "description": "string"
}
```

Данные продукта от клиента к серверу должны слаться в теле запроса в виде json-а, **не** в параметрах запроса.

Ваш сервис должен поддерживать следующие операции:
1. Добавить новый продукт. При этом его `id` должен сгенерироваться автоматически
   - `POST /product`
   - Схема запроса:
     ```json
     {
       "name": "string",
       "description": "string"
     }
     ```
   - Схема ответа: `<product-json>` (созданный продукт)
2. Получить продукт по его id
   - `GET /product/{product_id}`
   - Схема ответа: `<product-json>`
3. Обновить существующий продукт (обновляются только те поля продукта, которые были переданы в теле запроса)
   - `PUT /product/{product_id}`
   - Схема запроса: `<product-json>` (некоторые поля могут быть опущены)
   - Схема ответа: `<product-json>` (обновлённый продукт)
4. Удалить продукт по его id
   - `DELETE /product/{product_id}`
   - Схема ответа: `<product-json>` (удалённый продукт)
5. Получить список всех продуктов 
   - `GET /products`  
   - Схема ответа:
     ```
     [ 
       <product-json-1>,
       <product-json-2>, 
       ... 
     ]
     ```

Предусмотрите возвращение ошибок (например, если запрашиваемого продукта не существует).

Вы можете положить код сервиса в отдельную директорию рядом с этим документом.

### Задание Б (3 балла)
Продемонстрируйте работоспособность сервиса с помощью программы Postman
(https://www.postman.com/downloads) и приложите соответствующие скрины, на которых указаны
запросы и ответы со стороны сервиса для **всех** его операций.

#### Демонстрация работы
1. get products на пустом списке: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/1_get_empty.png)
2. get product по несуществующему id: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/2_get_wrong_id.png)
3. добавление продукта: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/3_post_product.png)
   ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/4_post_product_2.png)
   ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/5_post_product_3.png)
4. получение списка продуктов:  ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/6_2_get_products_first_part_seen.png) ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/6_1_get_products_without_body.png)
5. получение продукта по корректному id: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/7_get_product_by_id.png)
6. частичное изменение продукта: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/8_put_product_partially_info.png)
7. полное изменение продукта: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/9_put_product_full_info.png)
8. проверка, что продукт изменился -- получение всех продуктов: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/10_get_all_products.png)
9. удаление продукта: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/11_delete_product.png)
10. проверка, что продукт удален: ![alt text](https://github.com/arnyyyyy/networks-course/blob/master/lab02/images/12_check_product_doesnt_exist.png)

### Задание В (4 балла)
Пусть ваш продукт также имеет иконку (небольшую картинку). Формат иконки (картинки) может
быть любым на ваш выбор. Для простоты будем считать, что у каждого продукта картинка одна.

Добавьте две новые операции:
1. Загрузить иконку:
   - `POST product/{product_id}/image`
   - Запрос содержит бинарный файл — изображение  
     <img src="images/post-image.png" width=500 />
2. Получить иконку:
   - `GET product/{product_id}/image`
   - В ответе передаётся только сама иконка  
     <img src="images/get-image.png" width=500 />

Измените операции в Задании А так, чтобы теперь схема продукта содержала сведения о загруженной иконке, например, имя файла или путь:
```json
"icon": "string"
```

#### Демонстрация работы
todo

---

_(*) В последующих домашних заданиях вам будет предложено расширить функционал данного сервиса._

## Задачи
### Задача 1 (2 балла)
Общая (сквозная) задержка прохождения для одного пакета от источника к приемнику по пути,
состоящему из $N$ соединений, имеющих каждый скорость $R$ (то есть между источником и
приемником $N - 1$ маршрутизатор), равна $d_{\text{сквозная}} = N \dfrac{L}{R}$
Обобщите данную формулу для случая пересылки количества пакетов, равного $P$.

#### Решение
* Рассмотрим путь последнего (P-го) пакета: общее время его пути равно сумме времени в очереди и его времени в пути.
* Перед ним P-1 пакет, следовательно время в очереди составит $(P - 1) \dfrac{L}{R}$
* На путь последнего пакета до приемника по условию уйдет $N \dfrac{L}{R}$
*   Итоговая задержка =  $(P - 1) \dfrac{L}{R}$ +  $N \dfrac{L}{R}$ = $(P - 1 + N) \dfrac{L}{R}$

### Задача 2 (2 балла)
Допустим, мы хотим коммутацией пакетов отправить файл с хоста A на хост Б. Между хостами установлены три
последовательных канала соединения со следующими скоростями передачи данных:
$R_1 = 200$ Кбит/с, $R_2 = 3$ Мбит/с и $R_3 = 2$ Мбит/с.
Сколько времени приблизительно займет передача на хост Б файла размером $5$ мегабайт?
Как это время зависит от размера пакета?

#### Решение
* min($R_1$, $R_2$, $R_3$) = 200 Кбит/с = 2 * $10^5$ бит/с <br/>
* 5 мегабайт /  2 * $10^5$ бит/с   = 5 * 8 * $10^6$ бит / 2 * $10^5$ бит/с <br/> = 200 с <br/>
* Если пакеты слишком маленькие, то заголовки пакетов начинают составлять большой оверхед и скорость передачи снижается, так как в итоговом трафике на каждый байт файла приходится несколько служебных. В остальном время не сильно зависит от размера пакета.




### Задача 3 (2 балла)
Предположим, что пользователи делят канал с пропускной способностью $2$ Мбит/с. Каждому
пользователю для передачи данных необходима скорость $100$ Кбит/с, но передает он данные
только в течение $20$ процентов времени использования канала. Предположим, что в сети всего $60$
пользователей. А также предполагается, что используется сеть с коммутацией пакетов. Найдите
вероятность одновременной передачи данных $12$ или более пользователями.

#### Решение
* P(одновременно 12 и более пользователей) = 1 - P(одновременно 1 пользователь) - P(одновременно 2 пользователя) - .. - P(одновременно 11 пользователей)
* = 1 - $\sum_{k=1}^{11} {0.2^k} * {0.8^{60 - k}} * {{60}\choose{k}}$  ~ 0.551

### Задача 4 (2 балла)
Пусть файл размером $X$ бит отправляется с хоста А на хост Б, между которыми три линии связи и
два коммутатора. Хост А разбивает файл на сегменты по $S$ бит каждый и добавляет к ним
заголовки размером $80$ бит, формируя тем самым пакеты длиной $L = 80 + S$ бит. Скорость
передачи данных по каждой линии составляет $R$ бит/с. Загрузка линий мала, и очередей пакетов
нет. При каком значении $S$ задержка передачи файла между хостами А и Б будет минимальной?
Задержкой распространения сигнала пренебречь.

#### Решение
* Используем формулу из первого задания: задержка передачи файла между А и Б = $(P - 1 + N) \dfrac{L}{R}$ = $(\dfrac{X}{S} - 1 + N) \dfrac{L}{R}$ =  $(\dfrac{X}{S} - 1 + N) \dfrac{80 + S}{R}$
* Чтобы найти минимум, возьмем производную по S:
    * $\dfrac{-80X}{R S^2} + \dfrac{N}{R} - \dfrac{1}{R} = 0$

    * $\dfrac {80 * X}{R * S^2}$= $\dfrac{N- 1}{R}$
* S = $\sqrt{\dfrac{80X}{N-1}} = \sqrt{40X}$, так как N = 3 по условию
* возьмем ближайшее целое число

### Задание 5 (2 балла)
Рассмотрим задержку ожидания в буфере маршрутизатора. Обозначим через $I$ интенсивность
трафика, то есть $I = \dfrac{L a}{R}$.
Предположим, что для $I < 1$ задержка ожидания вычисляется как $\dfrac{I \cdot L}{R (1 – I)}$.
1. Напишите формулу для общей задержки, то есть суммы задержек ожидания и передачи.
2. Опишите зависимость величины общей задержки от значения $\dfrac{L}{R}$.

#### Решение
1.  * Задержка передачи = $\dfrac{L}{R}$, задержка ожидания =  $\dfrac{I \cdot L}{R (1 – I)}$ <br/>
* Общая задержка = $\dfrac{L}{R}$ + $\dfrac{I \cdot L}{R (1 – I)}$ = $\dfrac{L}{R}$ $(1 + \dfrac{I}{1-I})$ = $\dfrac{L}{R (1 - I)}$
2. $\dfrac{L}{R (1 - I)}$ = $\dfrac{L}{R} * \dfrac{1}{1 - \alpha \dfrac{L}{R}}$ <br/> Если $\dfrac{L}{R}$ растет, то растет общая задержка, если убывает, то и задержка убывает. <br/> Таким образом, зависимость линейная.
